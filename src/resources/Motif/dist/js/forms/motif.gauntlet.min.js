/*!
 * Motif Gauntlet v1.0.0 (2014-04-04)
 * Trials and tribulations to validate your forms
 * http://getmotif.com
 * 
 * @author Jonathan Pacheco <jonathan@lifeblue.com>
 */
!function(a,b,c,d,e){"use strict";var f=function(b){return this.$elem=a(b),this.elem=this.$elem[0],this},g=function(b){return this.$elem=a(b),this.elem=this.$elem[0],this},h=a(c);f.prototype={defaults:{alertClasses:{error:"input-alert--error",success:"input-alert--success"},labelClasses:{error:"is-erroneous",success:"is-successful",disabled:"is-disabled"},messages:{},patterns:{},check:[],ignore:[],errorReport:null,ajaxSubmit:null,scrollToError:!0,addTest:[]},fields:["input[type='text']","input[type='email']","input[type='search']","input[type='tel']","input[type='url']","input[type='number']","input[type='password']","input[type='checkbox']","input[type='radio']","textarea","select"],passed:[],failed:[],init:function(a){return this.$elem.length?(this.initVars(a),this.prepForm(),this.bindErrorHandling(),this.gatherInputs(),this.bindInputs(),this):void 0},initVars:function(b){this.config=b,this.metadata=this.$elem.data("gauntlet-options"),this.options=a.extend(!0,{},this.defaults,this.config,this.metadata),this.checkboxes={},this.updateInputList()},updateInputList:function(){this.options.check.length&&this.addToInputList(),this.options.ignore.length&&this.removeFromInputList()},addToInputList:function(){var a,b=!1;for(a=this.options.check.length-1;a>=0;a-=1){var c=this.options.check[a];b=this.inputIsInList(c),b||this.fields.push(c)}return this.fields},removeFromInputList:function(){var a,b=!1;for(a=this.options.ignore.length-1;a>=0;a-=1){var c=this.options.ignore[a];b=this.inputIsInList(c),b&&this.fields.splice(b,1)}return this.fields},inputIsInList:function(b){var c=a.inArray(b,this.fields);return-1===c?!1:c},prepForm:function(){this.$elem.attr("novalidate",!0)},bindErrorHandling:function(){var a=this;h.on("gauntlet/fail",function(b,c){a.inputError.call(a,c)}),h.on("gauntlet/success",function(b,c){a.inputSuccess.call(a,c)}),h.on("ajax/complete",function(b,c){a.enableSubmit.call(a,c)}),a.options.scrollToError&&h.on("gauntlet/fail/first",function(b,c){a.scrollToError.call(a,c)})},gatherInputs:function(){return this.$fields=this.fields.join(", "),this.$fields},bindInputs:function(){var b=this;b.$elem.on("change",b.$fields,function(){b.getVerdict.call(b,a(this)),b.errorReport.call(b,b.passed,b.failed),b.resetVerdicts.call(b)}),b.$elem.on("submit",function(){return b.disableSubmit.call(b),b.submitForm.call(b)})},getVerdict:function(a){return this.sortResult(this.validate(a))},sortResult:function(a){return a.passes?this.passed.push(a):this.failed.push(a),[this.passed,this.failed]},errorReport:function(a,b){"function"==typeof this.options.errorReport?this.options.errorReport.call(this,a,b):(this.passedGauntlet(a),this.failedGauntlet(b))},passedGauntlet:function(a){if(a.length)for(var b=a.length-1;b>=0;b--)h.trigger("gauntlet/success",[a[b]])},failedGauntlet:function(a){var b;if(a.length)for(b=a.length-1;b>=0;b-=1)h.trigger("gauntlet/fail",[a[b]]),0===b&&h.trigger("gauntlet/fail/first",[a[b]])},disableSubmit:function(a){var b=a||this.$elem;b.find("[type='submit']").prop("disabled",!0).addClass(this.options.labelClasses.disabled)},enableSubmit:function(a){var b=a||this.$elem;b.find("[type='submit']").prop("disabled",!1).removeClass(this.options.labelClasses.disabled)},scrollToError:function(b){a("html, body").animate({scrollTop:b.$elem.offset().top-50},500)},inputError:function(a){"checkbox"===a.type||"radio"===a.type?this.checkboxError(a):(a.$elem.closest("label").removeClass(this.options.labelClasses.success).addClass(this.options.labelClasses.error),this.addMessage(a))},checkboxError:function(b){var c=b.$elem.closest("ul",this.$elem),d=b.$elem.closest("label")||a("label[for='"+b.$elem.attr("id")+"']");c.length?this.addMessage(b,c):this.addMessage(b,d)},addMessage:function(a,b){var c=b||a.$elem,d=c.next("."+this.options.alertClasses.error);d.length||c.after("<strong class='"+this.options.alertClasses.error+"'>"+a.errorMessage+"</strong>")},inputSuccess:function(a){if("checkbox"===a.type||"radio"===a.type)this.checkboxSuccess(a);else{var b=a.$elem.closest("label");b.removeClass(this.options.labelClasses.error),a.val?b.addClass(this.options.labelClasses.success):b.removeClass(this.options.labelClasses.success),this.removeMessage.call(this,a)}},checkboxSuccess:function(b){var c=b.$elem.closest("ul",this.$elem),d=b.$elem.closest("label")||a("label[for='"+b.$elem.attr("id")+"']");c.length?this.removeMessage(b,c):this.removeMessage(b,d)},removeMessage:function(a,b){var c=b||a.$elem;c.next("."+this.options.alertClasses.error).remove()},resetVerdicts:function(){this.passed=[],this.failed=[],this.checkboxes={}},checkAllFields:function(){var b=this,c=!0;return b.$elem.find(b.$fields).each(function(){b.getVerdict.call(b,a(this))}),b.errorReport.call(b,b.passed,b.failed),b.failed.length&&(c=!1),b.resetVerdicts.call(b),c},submitForm:function(){var a=this.checkAllFields();return a&&"function"==typeof this.options.ajaxSubmit?(this.options.ajaxSubmit(),!1):(a||this.enableSubmit(),a)},validate:function(b){var c=a.data(b[0],"gauntletInput");return c?b.gauntletInput("validateInput"):(b.gauntletInput({messages:this.options.messages,patterns:this.options.patterns,addTest:this.options.addTest},this),c=a.data(b[0],"gauntletInput")),c}},g.prototype={init:function(a,b){return this.initVars(a,b),this.getTests(),this.validateInput(),this},defaults:{messages:{email:"A valid email address is required.",emailConfirm:"Check that your email addresses match.",text:"This field is required.",totals:"Check that your totals don't exceed the limit",tel:"Make sure you've entered a valid phone number.",search:"Please input a search term.",number:"Enter a valid number.",error:"There was an error.",password:"Your password must match the criteria.",passwordConfirm:"Be sure that your passwords match.",radio:"Please choose one of the options above.",checkbox:"Please check at least one option.",select:"Select an option."},patterns:{email:/^([a-zA-Z0-9._%+\-])+@([a-zA-Z0-9_.\-])+\.([a-zA-Z])+([a-zA-Z])+/,tel:/^((([0-9]{1})*[\- .(]*([0-9]{3})[\- .)]*[0-9]{3}[\- .]*[0-9]{4})+)*$/,number:/^[0-9]*/}},initVars:function(b,c){this.config=b,this.metadata=this.$elem.data("gauntlet-input-options"),this.options=a.extend(!0,{},this.defaults,this.config,this.metadata),this.type=this.getType(this.$elem),this.disabled=this.$elem.prop("disabled"),this.required=this.$elem.attr("required"),this.confirm=this.$elem.attr("data-gauntlet-confirm"),this.confirm?this.$confirms=a("#"+this.confirm):a("[data-gauntlet-confirm='"+this.$elem.attr("id")+"']").length&&(this.$confirmedBy=a("[data-gauntlet-confirm='"+this.$elem.attr("id")+"']")),this.gauntlet=c||a.data(this.$elem.closest("form")[0],"gauntlet"),this.$form=this.gauntlet.$elem||this.$elem.closest("form"),this.name=this.$elem.attr("name"),this.pattern=this.$elem.attr("pattern")||this.options.patterns[this.type]||!1,this.tests=[],this.errorMessage=this.$elem.attr("data-error"),this.errorMessage||(this.errorMessage=this.confirm?this.options.messages[this.type+"Confirm"]:this.options.messages[this.type])},updateValue:function(){return this.val=this.$elem.val()},getType:function(a){var b=a.attr("type");return b&&"select-one"!==b||(b=a.is("select")?"select":a.is("textarea")?"textarea":"text"),b},getTests:function(){var a,b=this;if(b.pattern&&b.tests.push("patternTest"),b.confirm&&b.tests.push("confirmTest"),("checkbox"===b.type||"radio"===b.type)&&b.tests.push("checkboxTest"),b.gauntlet.options.addTest.length)for(a=b.gauntlet.options.addTest.length-1;a>=0;a-=1)b.runUserTest.call(b,b.gauntlet.options.addTest[a]);return b.tests},runUserTest:function(a){var b=a.condition.call(this,this.$elem);return b&&this.tests.push(a.test),b},validateInput:function(){var b,c=this,d=[];if(c.updateValue.call(c),this.disabled!==!0)if(""===a.trim(c.val))c.passes=c.required?!1:!0;else{for(b=c.tests.length-1;b>=0;b-=1)"function"==typeof c.tests[b]?d.push(c.tests[b].call(c,c.$elem)):d.push(c[c.tests[b]].call(c));c.passes=-1!==d.indexOf(!1)?!1:!0}return c.passes},requiredTest:function(){return this.required?!1:!0},confirmTest:function(){return this.val!==this.$confirms.val()?!1:!0},patternTest:function(){var a=new RegExp(this.pattern);return a.test(this.val)?!0:!1},checkboxTest:function(){var a,b;return this.required?this.gauntlet.checkboxes[this.name]?!0:(a=this.$form.find("input[name='"+this.name+"']"),b=a.filter(":checked").length?!0:!1,this.gauntlet.checkboxes[this.name]={elems:a,verdict:b},b):!0}},f.defaults=f.prototype.defaults,g.defaults=g.prototype.defaults,d.apps.Gauntlet=f,d.apps.GauntletInput=g}(jQuery,window,document,window.Motif=window.Motif||{utils:{},apps:{}}),jQuery.createPlugin("gauntlet",window.Motif.apps.Gauntlet),jQuery.createPlugin("gauntletInput",window.Motif.apps.GauntletInput);